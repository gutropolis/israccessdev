{% extends "admin/layouts/layout-admin.twig" %}
{% block maincontent %} 
<style type="text/css">
.dash-box {
    position: relative;
    background: rgb(255, 86, 65);
    background: -moz-linear-gradient(top, rgba(255, 86, 65, 1) 0%, rgba(253, 50, 97, 1) 100%);
    background: -webkit-linear-gradient(top, rgba(255, 86, 65, 1) 0%, rgba(253, 50, 97, 1) 100%);
    background: linear-gradient(to bottom, rgba(255, 86, 65, 1) 0%, rgba(253, 50, 97, 1) 100%);
    filter: progid: DXImageTransform.Microsoft.gradient( startColorstr='#ff5641', endColorstr='#fd3261', GradientType=0);
    border-radius: 4px;
    text-align: center;
    margin: 60px 0 50px;
}
.dash-box-icon {
    position: absolute;
    transform: translateY(-50%) translateX(-50%);
    left: 50%;
}
.dash-box-action {
    transform: translateY(-50%) translateX(-50%);
    position: absolute;
    left: 50%;
}
.dash-box-body {
    padding: 50px 20px;
}
.dash-box-icon:after {
    width: 60px;
    height: 60px;
    position: absolute;
    background: rgba(247, 148, 137, 0.91);
    content: '';
    border-radius: 50%;
    left: -10px;
    top: -10px;
    z-index: -1;
}
.dash-box-icon > i {
    background: #ff5444;
    border-radius: 50%;
    line-height: 40px;
    color: #FFF;
    width: 40px;
    height: 40px;
	font-size:22px;
}
.dash-box-icon:before {
    width: 75px;
    height: 75px;
    position: absolute;
    background: rgba(253, 162, 153, 0.34);
    content: '';
    border-radius: 50%;
    left: -17px;
    top: -17px;
    z-index: -2;
}
.dash-box-action > button {
    border: none;
    background: #FFF;
    border-radius: 19px;
    padding: 7px 16px;
    text-transform: uppercase;
    font-weight: 500;
    font-size: 11px;
    letter-spacing: .5px;
    color: #003e85;
    box-shadow: 0 3px 5px #d4d4d4;
}
.dash-box-body > .dash-box-count {
    display: block;
    font-size: 30px;
    color: #FFF;
    font-weight: 300;
}
.dash-box-body > .dash-box-title {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.81);
}
.dash-box.dash-box-color-2 {
    background: rgb(252, 190, 27);
    background: -moz-linear-gradient(top, rgba(252, 190, 27, 1) 1%, rgba(248, 86, 72, 1) 99%);
    background: -webkit-linear-gradient(top, rgba(252, 190, 27, 1) 1%, rgba(248, 86, 72, 1) 99%);
    background: linear-gradient(to bottom, rgba(252, 190, 27, 1) 1%, rgba(248, 86, 72, 1) 99%);
    filter: progid: DXImageTransform.Microsoft.gradient( startColorstr='#fcbe1b', endColorstr='#f85648', GradientType=0);
}
.dash-box-color-2 .dash-box-icon:after {
    background: rgba(254, 224, 54, 0.81);
}
.dash-box-color-2 .dash-box-icon:before {
    background: rgba(254, 224, 54, 0.64);
}
.dash-box-color-2 .dash-box-icon > i {
    background: #fb9f28;
}

.dash-box.dash-box-color-3 {
    background: rgb(183,71,247);
    background: -moz-linear-gradient(top, rgba(183,71,247,1) 0%, rgba(108,83,220,1) 100%);
    background: -webkit-linear-gradient(top, rgba(183,71,247,1) 0%,rgba(108,83,220,1) 100%);
    background: linear-gradient(to bottom, rgba(183,71,247,1) 0%,rgba(108,83,220,1) 100%);
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b747f7', endColorstr='#6c53dc',GradientType=0 );
}
.dash-box-color-3 .dash-box-icon:after {
    background: rgba(180, 70, 245, 0.76);
}
.dash-box-color-3 .dash-box-icon:before {
    background: rgba(226, 132, 255, 0.66);
}
.dash-box-color-3 .dash-box-icon > i {
    background: #8150e4;
}
select2-selection__placeholder{
 color:black !important;
}
</style>
<!-- BEGIN: Subheader -->
<div class="m-subheader ">
  <div class="d-flex align-items-center">
    <div class="mr-auto">
      <h3 class="m-subheader__title "> {{ title}} </h3>
    </div>
    <div> </div>
  </div>
</div>
<!-- END: Subheader -->
<div class="m-content"> 
  <!-- == Main Content  start here ========== -->
  
  	<div class="row">
		<div class="col-md-4">
			<div class="dash-box dash-box-color-1">
				<div class="dash-box-icon">
					<i class="fa fa-cloud"></i>
				</div>
				<div class="dash-box-body">
					<span class="dash-box-count">{{ all_events }}</span>
					<span class="dash-box-title">{{ adminLang.dashboard_all_events_txt }}</span>
				</div>
				
							
			</div>
		</div>
		<div class="col-md-4">
			<div class="dash-box dash-box-color-2">
				<div class="dash-box-icon">
					<i class="fa fa-download"></i>
				</div>
				<div class="dash-box-body">
					<span class="dash-box-count">{{ all_tickets }}</span>
					<span class="dash-box-title">{{ adminLang.dashboard_all_tickets_txt }}</span>
				</div>
				
								
			</div>
		</div>
		<div class="col-md-4">
			<div class="dash-box dash-box-color-3">
				<div class="dash-box-icon">
					<i class="fa fa-heart"></i>
				</div>
				<div class="dash-box-body">
					<span class="dash-box-count">{{ all_sale_amount }}</span>
					<span class="dash-box-title">{{ adminLang.dashboard_total_sale_amount_txt }}</span>
				</div>
				
								
			</div>
		</div>
	</div>
  <div class="row">
    <div class="col-xl-12"> 
      <!--begin::Portlet-->
      <div class="m-portlet " id="m_portlet">
        <div class="m-portlet__head">
          <div class="m-portlet__head-caption">
            <div class="m-portlet__head-title"> <span class="m-portlet__head-icon"> <i class="flaticon-map-location"></i> </span>
              <h3 class="m-portlet__head-text"> Event Sale Report </h3>
            </div>
          </div>
        </div>
        <div class="m-portlet__body">
		<form id="saleReportFrm" method="get" action="{{ base_url() }}/productor/dashboard">
     <div class="row">
      <div class="form-group col-md-5" style="margin-left:-20px">
      <select class="form-control category_id m-select2" id="m_select1_event_dashboard"  name="event_group_id"  style="width:100%" data-placeholder="Select Event Group">
        <option value="">N/A</option>
                {% if groups %}
                {% for row in groups %}
				{% set selected = '' %}
				{% if event_group_id == row.id %}
			    {% set selected = 'selected' %}
			    {% endif %}
        <option value="{{ row.id }}" {{ selected }}>{{ row.title|raw }}</option>
               {% endfor %} 
               {% endif %}
                  
      </select>
    </div>
    <div class="form-group col-md-3">
      <select class="form-control " id="event_id"  name="event_id"  style="width:100%"  >
	   <option value="">Select Event</option>
	   {% if options %}
                {% for row in options %}
				{% set selected = '' %}
				{% set selected = '' %}
				{% if event_id == row.id %}
				{% set selected = 'selected' %}
				{% endif %}
        <option value="{{ row.id }}" {{ selected }}>{{ row.title|raw }}</option>
               {% endfor %} 
               {% endif %}
      </select>
    </div>
	<div class="form-group col-md-4" style="margin-top:0px">
	<a href="javascript:void(0);" onclick="SearchSaleReport()" class="btn btn-info">View Report</a>
                  <a href="javascript:void(0);" onclick="reloadDashboard()" class="btn btn-danger">Clear Report</a>
                </div>
  </div>
  
</form>
			   {% if event_id != '' %}
			  <div id='container_chart_div' style='min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto'></div>
			  <br>
			  {% if orderReportList != '' %}
			  <a href="javascript:void(0);" onclick="downloadSaleReport({{ event_group_id }}, {{ event_id }})" class="btn btn-info pull-right">Download Report</a> <br>
			  {% endif %}
			  <br><br>
			  <table class="table table-striped m-table table-bordered">
			  <thead>
				<tr>
				 <th>Nom</th>
				 <th>Prénom</th>
				  <th>Téléphone</th>
				  <th>Mail</th>
				  <th>Ticket Type</th>
				  <th> Source </th>
				  <th> Catégorie  </th>
				  <th> Rang </th>
				  <th> Siège </th>
				</tr>
			  </thead>
			  <tbody>
				{{ orderReportList|raw }}
			  </tbody>

			</table>

			   {% endif %}
		
		
        </div>
      </div>
      <!--end::Portlet--> 
    </div>
  </div>
</div>
{% endblock %}
{% block footerscripts %} 
<!--begin::Page Vendors --> 

<!--end::Page Vendors --> 
<!--begin::Page Snippets --> 
<script src="{{ base_url() }}/assets/app/js/dashboard.js" type="text/javascript"></script> 
<script src="{{ base_url() }}/assets/admin/demo/default/custom/components/forms/widgets/bootstrap-switch.js" type="text/javascript"></script> 
<script src="{{ base_url() }}/assets/admin/demo/default/custom/components/forms/widgets/select2.js" type="text/javascript"></script> 
<script src="{{ base_url() }}/assets/admin/dynamic_datatables/data-ajax-admin-dashboard.js" type="text/javascript"></script> 
<script>
$(document).ready(function(){
 $('.btn_changepermission').bootstrapSwitch({size : 'large', on: 'Enabled',
      off: 'Disabled'});
    var stopchange = false;
    $('.btn_changepermission').on('switchChange.bootstrapSwitch', function (e, state) {
        var obj = $(this);
        if(stopchange === false){
            $.ajax({
                url: "./updateSiteMode",
                dataType: 'json',
                type: "POST",
                quietMillis: 100,
                data: { 
                    is_for_maintenance: $(this).data('auid'),
                },
                success: function(result) {
                    if(result.status) {
                        location.reload();
                    } else {
                       // alert('Error:'+result['message']);
                        if(stopchange === false){
                            stopchange = true;
                            obj.bootstrapSwitch('toggleState');
                            stopchange = false;
                        }
                    }
                },
                error: function(result) {
                    alert('Error! Unable to find this agentuser.');
                    if(stopchange === false){
                        stopchange = true;
                        obj.bootstrapSwitch('toggleState');
                        stopchange = false;
                    }
                }
            });
        }
    }); 
	
 
  
  });
</script>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script>
// chart tod isplay
// Radialize the colors
Highcharts.setOptions({
    colors: Highcharts.map(Highcharts.getOptions().colors, function (color) {
        return {
            radialGradient: {
                cx: 0.5,
                cy: 0.3,
                r: 0.7
            },
            stops: [
                [0, color],
                [1, Highcharts.Color(color).brighten(-0.3).get('rgb')] // darken
            ]
        };
    })
});

// Build the chart
Highcharts.chart('container_chart_div', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Sale report of , {{ event_name }}'
    },
    tooltip: {
        pointFormat: '{point.name}: <b>{point.y}</b>'
    },
	
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
			colors: ['#a9ff96', '#f15c80', '#7cb5ec'],
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.y}',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                },
                connectorColor: 'silver'
            }
        }
    },
    series: [{
        name: 'Share',
        data: [
            { name: 'Total Booked', y: {{total_booked_seats}} },
            { name: 'Total Left', y: {{ total_seats-total_booked_seats }} },
            { name: 'Total Sale', y: {{ total_sale }} }
        ]
    }]
});
</script>
<!--end::Page Snippets --> 
<!--   {% block addfooter %}{% endblock %} --> 
{% endblock %} 